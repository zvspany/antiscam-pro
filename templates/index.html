<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AntiScam Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="transition-theme">

<div class="container py-5"> {# Standardowy kontener Bootstrap, responsywny #}
    {# Nag贸wek z tytuem i przyciskami - u偶ywamy flexbox z responsywnoci #}
    {# d-flex justify-content-between align-items-center standardowo w rzdzie #}
    {# flex-column-sm-row: na ekranach mniejszych ni偶 'sm' (small) stackuj w kolumn, od 'sm' w g贸r (row) #}
    <div class="d-flex justify-content-between align-items-center mb-4 flex-column flex-sm-row">
        {# Tytu - dodajemy margines dolny na maych ekranach (mb-3), usuwamy od sm w g贸r (mb-sm-0) #}
        <h1 class="fw-bold mb-3 mb-sm-0">AntiScam Pro</h1>
        {# Kontener przycisk贸w - te偶 stackujemy na maych ekranach #}
        <div class="d-flex flex-column flex-sm-row">
            {# Przycisk motywu - dodajemy margines dolny na maych ekranach (mb-2), prawy od sm w g贸r (me-sm-2) #}
            <button id="toggleTheme" class="btn btn-outline-secondary mb-2 me-sm-2">
                <i class="fas fa-moon"></i> <span id="theme-btn-text" data-pl="Zmie motyw" data-en="Toggle theme">Zmie motyw</span>
            </button>
            {# Przycisk jzyka - nie potrzebuje dodatkowych margines贸w przy stackowaniu/rzdzie #}
            <button id="toggleLanguage" class="btn btn-outline-secondary">
                <i class="fas fa-language"></i> <span id="lang-btn-text">EN</span>
            </button>
        </div>
    </div>

    {# Formularz - standardowe form-control s responsywne wewntrz rodzica #}
    <form method="POST" class="bg-body-tertiary p-4 rounded shadow-sm">
        <input type="hidden" name="lang" id="langInput" value="pl">
        <div class="mb-3">
            {# Zastpiono 3 inputy jednym textarea #}
            <label for="single_input" class="form-label" data-pl="Wprowad藕 dane do analizy:" data-en="Enter data for analysis:">Wprowad藕 dane do analizy:</label>
            <textarea name="input_data" id="single_input" rows="3" class="form-control"
                      data-pl-placeholder="Wprowad藕 wiadomo, numer telefonu lub link..."
                      data-en-placeholder="Enter message, phone number, or link..."
                      placeholder="Wprowad藕 wiadomo, numer telefonu lub link..."></textarea>
        </div>
        {# Usunito divy mb-3 dla numeru telefonu i linku #}
        <button type="submit" class="btn btn-primary" data-pl="Sprawd藕" data-en="Check">Sprawd藕</button>
    </form>

    {# Sekcja wynik贸w - alerty Bootstrapa s blokowe i responsywnie ukadaj si #}
    {# Dodano div.mt-4 dla odstpu od formularza #}
    <div class="mt-4">

        {# Wynik wiadomoci #}
        {% if result.message %}
        <div class="alert {{ 'alert-danger' if result.message.is_suspicious else 'alert-success' }}">
            <strong data-pl="Wiadomo:" data-en="Message:">Wiadomo:</strong>
            {% if result.message.is_suspicious %}
                {% if result.message.suspicious_words %}
                    <span data-pl="Podejrzana. Znalezione wyrazy:" data-en="Suspicious. Found words:">Podejrzana. Znalezione wyrazy:</span>
                    <em>{{ result.message.suspicious_words | join(', ') }}</em>
                {% endif %}
                {% if result.message.ai_result %}
                    <p data-pl="Wykryte przez AI:" data-en="Detected by AI:">Wykryte przez AI:</p>
                    <p>{{ result.message.ai_result.label }} ({{ (result.message.ai_result.confidence * 100) | round(1) }}%)</p>
                {% endif %}
            {% else %}
                <span data-pl="Brak podejrzanych treci." data-en="No suspicious content.">Brak podejrzanych treci.</span>
            {% endif %}
        </div>
        {% endif %}

        {# Wynik telefonu #}
        {% if result.phone %}
        <div class="alert {{ 'alert-danger' if result.phone.is_suspicious else 'alert-success' }}">
            <strong data-pl="Numer telefonu:" data-en="Phone number:">Numer telefonu:</strong>
            {% if result.phone.is_suspicious %}
                <span data-pl="Podejrzany numer." data-en="Suspicious number.">Podejrzany numer.</span>
                <p data-pl="Pow贸d podejrzenia: Numer w bazie danych podejrzanych numer贸w." data-en="Reason: Number found in suspicious database.">
                    Pow贸d podejrzenia: Numer w bazie danych podejrzanych numer贸w.
                </p>
            {% else %}
                <span data-pl="Wyglda na bezpieczny." data-en="Looks safe.">Wyglda na bezpieczny.</span>
            {% endif %}
        </div>
        {% endif %}

        {# Sekcja wynik贸w linku - Dostosowana do backendu umieszczajcego podsumowanie VT w details #}
        {# Pokazujemy sekcj, jeli wynik linku (result.link) jest zdefiniowany i ma list szczeg贸贸w lub jest oznaczony jako podejrzany #}
        {% if result.link is defined and (result.link.is_suspicious or result.link.details) %}

            {# Okrelamy og贸lny status podejrzewania na podstawie flagi is_suspicious z backendu #}
            {# Backend (endpoints.py) ustawia is_suspicious na podstawie lokalnych detekcji ORAZ wykrycia przez VT #}
            {% set overall_link_suspicious_display = result.link.is_suspicious %}

            <div class="alert {{ 'alert-danger' if overall_link_suspicious_display else 'alert-success' }}">
                <strong data-pl="Link:" data-en="Link:">Link:</strong>

                {# Wywietlamy og贸lny status na podstawie flagi z backendu #}
                {% if overall_link_suspicious_display %}
                    <span style="color: red;" data-pl="Podejrzany." data-en="Suspicious.">Podejrzany.</span>
                {% else %}
                    <span style="color: green;" data-pl="Brak podejrzanej aktywnoci." data-en="No suspicious activity detected.">Brak podejrzanej aktywnoci.</span>
                {% endif %}

                {# Lista szczeg贸贸w analizy - Iterujemy tylko po result.link.details #}
                {% if result.link.details %} {# Tylko jeli lista szczeg贸贸w nie jest pusta #}
                     <p data-pl="Szczeg贸y analizy:" data-en="Analysis Details:">Szczeg贸y analizy:</p>
                    <ul>
                        {% for detail in result.link.details %} {# Ptla po elementach z listy details z backendu #}
                            <li>
                                {# Wywietlamy tekst szczeg贸u. To mo偶e by pow贸d lokalny LUB podsumowanie z VirusTotal #}
                                <span data-pl="{{ detail.get('data-pl', detail.get('text', '')) }}" data-en="{{ detail.get('data-en', detail.get('text', '')) }}">
                                    {# Domylny tekst na wypadek braku danych w szczeg贸le #}
                                    {{ detail.get('text', 'Nieznany szczeg贸 analizy / Unknown analysis detail') }}
                                </span>
                                {# KOMENTARZ: Brzmienie szczeg贸贸w lokalnych (np. "Domena znaleziona w naszej bazie danych podejrzanych domen.") #}
                                {# oraz podsumowania VirusTotal ("VirusTotal: X / Y...") jest generowane w api/endpoints.py w licie details. #}
                                {# Aby poprawi samo brzmienie (np. usun "w URL" lub zmieni "Lokalnie"), musisz edytowa stringi data-pl/data-en w endpoints.py #}
                            </li>
                        {% endfor %}
                    </ul>
                {% elif not overall_link_suspicious_display %}
                     {# Ten blok wywietli si, jeli result.link jest zdefiniowane i nie jest podejrzane, ale lista details bya pusta (np. backend zwr贸ci pust list details) #}
                     {# Jako fallback, wywietlamy og贸lny komunikat, jeli nie ma 偶adnych szczeg贸贸w pomimo nie-podejrzanego statusu #}
                     {# Idealnie backend powinien zwraca co najmniej jeden szczeg贸 w details, jeli result.link jest zdefiniowane #}
                     <p data-pl="Brak dodatkowych szczeg贸贸w analizy." data-en="No additional analysis details.">Brak dodatkowych szczeg贸贸w analizy.</p>
                {% endif %}

                {# Opcjonalnie: mo偶na wywietli status is_valid z wyniku linku #}
                {% if result.link is defined and result.link.is_valid is defined %}
                   <p data-pl="Format URL poprawny: {{ 'Tak' if result.link.is_valid else 'Nie' }}" data-en="URL format valid: {{ 'Yes' if result.link.is_valid else 'No' }}">Format URL poprawny: {{ 'Tak' if result.link.is_valid else 'Nie' }}</p>
                {% endif %}


            </div> {# <-- Koniec div.alert dla wyniku linku #}

        {# Komunikat, jeli wynik linku (result.link) w og贸le nie przyszed (np. puste pole linku w formularzu) #}
        {% elif result.link is not defined %}
            {# Ten blok elif wywietli si, jeli result.link nie zostao zdefiniowane przez backend, np. w przypadku pustego inputu linku #}
             <div class="alert alert-info">
                <span data-pl="Podaj dane do analizy." data-en="Provide data for analysis.">Podaj dane do analizy.</span>
            </div>
        {% endif %} {# <-- Koniec g贸wnego if/elif dla linku #}


    </div> {# <-- Koniec div.mt-4 dla sekcji wynik贸w #}


    {# Sekcja Informacje i Statystyki #}
    {# Kontener dla informacji i statystyk - u偶ywa systemu grid col-md-6 #}
    <div class="container mt-4">
        <div class="row g-4">
            <div class="col-md-6"> {# Na ekranach < md bdzie na caej szerokoci, >= md na 6 kolumnach #}
                <div class="card h-100 transition-theme">
                    <div class="card-body">
                        <h2 class="card-title" data-pl="O AntiScam Pro" data-en="About AntiScam Pro">O AntiScam Pro</h2>
                        <p class="card-text" data-pl="AntiScam Pro to zaawansowana aplikacja do wykrywania oszustw..." data-en="AntiScam Pro is an advanced tool for scam detection...">
                            AntiScam Pro to zaawansowana aplikacja do wykrywania oszustw, spamu i podejrzanych link贸w. Korzysta z technologii sztucznej inteligencji (AI) oraz bazy danych, aby zapewni bezpieczestwo.
                        </p>

                        <h3 class="card-title" data-pl="Funkcje:" data-en="Features:">Funkcje:</h3>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item transition-theme" data-pl="Wykrywanie podejrzanych wiadomoci tekstowych" data-en="Detects suspicious text messages">Wykrywanie podejrzanych wiadomoci tekstowych</li>
                            <li class="list-group-item transition-theme" data-pl="Weryfikacja numer贸w telefon贸w i link贸w" data-en="Phone number and link verification">Weryfikacja numer贸w telefon贸w i link贸w</li>
                            <li class="list-group-item transition-theme">
                                <details>
                                    <summary data-pl="Integracja z VirusTotal" data-en="Integration with VirusTotal">Integracja z VirusTotal</summary>
                                    <p class="text-muted mt-2 transition-theme" data-pl="Analiza link贸w obejmuje skanowanie VirusTotal, jeli klucz API jest skonfigurowany, a link wymaga dodatkowej weryfikacji (np. jest skr贸cony lub oznaczony lokalnie jako podejrzany)." data-en="Link analysis includes VirusTotal scanning if API key is configured and the link requires extra verification (e.g., is shortened or locally flagged as suspicious).">
                                        Analiza link贸w obejmuje skanowanie VirusTotal, jeli klucz API jest skonfigurowany, a link wymaga dodatkowej weryfikacji (np. jest skr贸cony lub oznaczony lokalnie jako podejrzany).
                                    </p>
                                </details>
                            </li>
                             <li class="list-group-item transition-theme">
                                <details>
                                    <summary data-pl="Obszerne bazy danych" data-en="Extensive databases">Obszerne bazy danych</summary>
                                    <p class="text-muted mt-2 transition-theme" data-pl="Nasza baza zawiera ponad 186 000 podejrzanych domen." data-en="Our database contains over 186,000 suspicious domains.">
                                        Nasza baza zawiera ponad 186 000 podejrzanych domen.
                                    </p>
                                </details>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6"> {# Na ekranach < md bdzie na caej szerokoci, >= md na 6 kolumnach #}
                <div class="card h-100 transition-theme">
                    <div class="card-body">
                        <h3 class="card-title" data-pl=" Statystyki globalne" data-en=" Global statistics"> Statystyki globalne</h3>
                        <p class="text-muted transition-theme" data-pl="(od uruchomienia serwera)" data-en="(since server start)">(od uruchomienia serwera)</p>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item transition-theme">
                                <span data-pl="Wiadomoci sprawdzone:" data-en="Messages checked:">Wiadomoci sprawdzone:</span>
                                <span class="badge bg-primary">{{ global_stats.messages_checked }}</span>
                            </li>
                            <li class="list-group-item transition-theme">
                                <span data-pl="Numery sprawdzone:" data-en="Phones checked:">Numery sprawdzone:</span>
                                <span class="badge bg-primary">{{ global_stats.phones_checked }}</span>
                            </li>
                            <li class="list-group-item transition-theme">
                                <span data-pl="Linki sprawdzone:" data-en="Links checked:">Linki sprawdzone:</span>
                                <span class="badge bg-primary">{{ global_stats.links_checked }}</span>
                            </li>
                        </ul>

                        <h3 class="card-title mt-4" data-pl=" Twoje statystyki" data-en=" Your statistics"> Twoje statystyki</h3>
                        <p class="text-muted transition-theme" data-pl="(ta sesja)" data-en="(this session)">(ta sesja)</p>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item transition-theme">
                                <span data-pl="Wiadomoci sprawdzone:" data-en="Messages checked:">Wiadomoci sprawdzone:</span>
                                <span class="badge bg-info">{{ session_stats.messages_checked }}</span>
                            </li>
                            <li class="list-group-item transition-theme">
                                <span data-pl="Numery sprawdzone:" data-en="Phones checked:">Numery sprawdzone:</span>
                                <span class="badge bg-info">{{ session_stats.phones_checked }}</span>
                            </li>
                            <li class="list-group-item transition-theme">
                                <span data-pl="Linki sprawdzone:" data-en="Links checked:">Linki sprawdzone:</span>
                                <span class="badge bg-info">{{ session_stats.links_checked }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div> {# <-- Koniec div.container mt-4 dla Informacji/Statystyk #}

    {# Ten paragraf by poza kontenerem - dodano klasy dla lepszego wygldu #}
    <p class="mt-4 text-center text-muted" data-pl="Nasza aplikacja zapewnia u偶ytkownikom atwy spos贸b na rozpoznawanie pr贸b oszustw i unikania zagro偶e." data-en="Our app provides users with an easy way to recognize fraud attempts and avoid threats.">
        Nasza aplikacja zapewnia u偶ytkownikom atwy spos贸b na rozpoznawanie pr贸b oszustw i unikania zagro偶e.
    </p>

</div> {# <-- Koniec g贸wnego div.container py-5 #}


{# Skrypty JS - Standardowa praktyka to umieszczanie ich na kocu body #}

{# Skrypt Bootstrap JS - TYLKO JEDEN RAZ #}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{# Tw贸j niestandardowy kod JavaScript - MUSI BY W TYCH TAGACH SCRIPT - TYLKO JEDEN RAZ #}
<script>
const btnTheme = document.getElementById("toggleTheme");
    const btnLang = document.getElementById("toggleLanguage");
    const themeText = document.getElementById("theme-btn-text");
    const langText = document.getElementById("lang-btn-text");
    const langInput = document.getElementById("langInput");
    const singleInput = document.getElementById("single_input"); // Pole pojedynczego wejcia

    // Preferencja systemu u偶ytkownika dla trybu ciemnego
    const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');

    // Pobierz preferencje z localStorage, lub u偶yj preferencji systemu
    let darkMode = localStorage.getItem("darkMode");
    if (darkMode === null) {
        darkMode = prefersDarkMode.matches; // U偶yj preferencji systemu przy pierwszym uruchomieniu
    } else {
        darkMode = (darkMode === "true"); // Konwertuj string z localStorage na boolean
    }

    let lang = localStorage.getItem("lang") || "pl"; // Pobierz jzyk z localStorage lub domylnie PL

    // Funkcja aktualizujca tekst przycisku motywu w zale偶noci od trybu (ciemny/jasny) i jzyka
    function updateThemeButtonText(isDarkMode, currentLang) {
        const textPl = isDarkMode ? "Jasny motyw" : "Ciemny motyw";
        const textEn = isDarkMode ? "Light theme" : "Dark theme";
        // Sprawdzamy, czy element themeText istnieje przed pr贸b dostpu do jego waciwoci
        if (themeText) {
            themeText.dataset.pl = textPl;
            themeText.dataset.en = textEn;
            themeText.textContent = currentLang === "pl" ? textPl : textEn;
        }


        // Sprawdzamy, czy element btnTheme istnieje przed pr贸b znalezienia w nim ikony
        const themeIcon = btnTheme ? btnTheme.querySelector('i') : null;
        if (themeIcon) {
            themeIcon.classList.toggle('fa-moon', isDarkMode);
            themeIcon.classList.toggle('fa-sun', !isDarkMode);
        } else if (!btnTheme) {
             console.warn("Element with ID 'toggleTheme' not found."); // Dodaj ostrze偶enie, jeli przycisk motywu nie zosta znaleziony
        }
    }

    // Definicja funkcji applyTheme - SPRAWD殴 DOKADNIE T SEKCJE I SEKCJ POWY呕EJ!
    function applyTheme(isDarkMode) {
        // Sprawdzamy, czy document.body istnieje (zawsze powinien w tym miejscu)
        if (document.body) {
             document.body.classList.toggle("dark-mode", isDarkMode);
             // Aktualizuj tekst przycisku i ikon
             updateThemeButtonText(isDarkMode, lang); // Ta funkcja wywouje updateThemeButtonText
             localStorage.setItem("darkMode", isDarkMode);
        } else {
             console.error("document.body not found. Cannot apply theme class.");
        }
    }


    // Definicja funkcji applyLanguage z aktualizacj placeholdera
    function applyLanguage(language) {
        // Sprawdzamy, czy elementy istniej
        document.querySelectorAll("[data-pl]").forEach(el => {
            if (el.dataset.pl && el.dataset.en) {
                 el.textContent = el.dataset[language];
            }
        });
         // Aktualizacja placeholdera dla pojedynczego pola wejciowego
        if (singleInput) { // Sprawdzenie, czy element singleInput istnieje
             singleInput.placeholder = singleInput.dataset[language + '-placeholder'] || singleInput.placeholder;
        } else {
             console.warn("Element with ID 'single_input' not found."); // Dodaj ostrze偶enie
        }


        if (langText) {
             langText.textContent = language === "pl" ? "EN" : "PL";
        } else {
             console.warn("Element with ID 'lang-btn-text' not found."); // Dodaj ostrze偶enie
        }

        if (langInput) {
             langInput.value = language;
        } else {
             console.warn("Element with ID 'langInput' not found."); // Dodaj ostrze偶enie
        }


        localStorage.setItem("lang", language);
        updateThemeButtonText(darkMode, language); // Ta funkcja wywouje updateThemeButtonText
    }

    // Ustawienie pocztkowego motywu i jzyka - BD POJAWI SI TUTAJ (ReferenceError: applyTheme)
    // To oznacza, 偶e funkcja applyTheme nie zostaa zdefiniowana zanim doszo do tej linii.
    // PROBLEM MUSI BY W KODZIE PRZED DEFINICJ applyTheme.
    applyTheme(darkMode);
    applyLanguage(lang);

    // Nasuchiwanie na kliknicia przycisk贸w - SPRAWD殴 DOKADNIE T SEKCJE
    // Sprawdzamy, czy elementy btnTheme i btnLang istniej przed dodaniem listener贸w
    if (btnTheme) {
        btnTheme.addEventListener("click", () => {
            darkMode = !darkMode;
            applyTheme(darkMode); // Ta funkcja wywouje applyTheme
        });
    } else {
         console.warn("Element with ID 'toggleTheme' not found. Cannot add click listener.");
    }


    if (btnLang) {
        btnLang.addEventListener("click", () => {
            lang = lang === "pl" ? "en" : "pl";
            applyLanguage(lang); // Ta funkcja wywouje applyLanguage
        });
    } else {
         console.warn("Element with ID 'toggleLanguage' not found. Cannot add click listener.");
    }


    // Nasuchiwanie na zmiany preferencji systemu (ciemny/jasny motyw) - SPRAWD殴 DOKADNIE T SEKCJE
    // Sprawdzamy, czy prefersDarkMode istnieje
    if (prefersDarkMode) {
        prefersDarkMode.addListener(function(e) {
            // Jeli tryb motywu nie by ustawiony w localStorage (null), pod偶aj za systemem
            if (localStorage.getItem("darkMode") === null) {
                applyTheme(e.matches); // Ta funkcja wywouje applyTheme
            }
        });
    } else {
         console.warn("'prefers-color-scheme' media query not supported or not found."); // Dodaj ostrze偶enie
    }


    console.log("AntiScam Pro custom JavaScript script finished execution."); // Dodaj lini kontroln na kocu
</script>

</body> {# POJEDYNCZY TAG ZAMYKAJCY CIAO STRONY #}
</html> {# POJEDYNCZY TAG ZAMYKAJCY CAY DOKUMENT #}